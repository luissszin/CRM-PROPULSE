Supabase environment variables missing; using in-memory DB for development.
Initializing In-Memory DB...
[INFO] [requeueWorker] started
Serving frontend from C:\Users\jogod\crm-backend\frontend\dist
Created table: units
[32mÔ£ö backend\tests\integration_real.test.js [90m(4861.6428ms)[39m[39m
Supabase environment variables missing; using in-memory DB for development.
Initializing In-Memory DB...
[INFO] [requeueWorker] started
Serving frontend from C:\Users\jogod\crm-backend\frontend\dist
Created table: units
[INFO] [REQ] POST /admin/login {
  requestId: '73ffc360-a7b5-4a6e-b15b-be611fcbe801',
  ip: '::ffff:127.0.0.1'
}
[Auth] Login attempt: {
  email: 'admin@propulse.com',
  hasPassword: true,
  contentType: 'application/json'
}
[INFO] [RES] POST /admin/login {
  requestId: '73ffc360-a7b5-4a6e-b15b-be611fcbe801',
  status: 401,
  duration: 11,
  unitId: 'anon',
  userId: 'anon'
}
Admin login failed, creating admin user...
Created table: users (added admin)
Created table: contacts
Created table: leads
In-Memory DB initialized successfully.
[INFO] [REQ] POST /admin/login {
  requestId: '77d19d78-6e33-4655-92d0-bee41cd6b109',
  ip: '::ffff:127.0.0.1'
}
[Auth] Login attempt: {
  email: 'admin@propulse.com',
  hasPassword: true,
  contentType: 'application/json'
}
[INFO] [RES] POST /admin/login {
  requestId: '77d19d78-6e33-4655-92d0-bee41cd6b109',
  status: 200,
  duration: 117,
  unitId: 'anon',
  userId: 'anon'
}
[INFO] [REQ] POST /leads/units {
  requestId: 'e8afadad-5292-47d4-9071-ad06358ab517',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Success: User 2 (admin@propulse.com)
[INFO] [RES] POST /leads/units {
  requestId: 'e8afadad-5292-47d4-9071-ad06358ab517',
  status: 201,
  duration: 12,
  unitId: 'anon',
  userId: 2
}
[INFO] [REQ] POST /leads/units {
  requestId: '37c7850d-f1c7-40a5-970c-68de60688ebf',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Success: User 2 (admin@propulse.com)
[INFO] [RES] POST /leads/units {
  requestId: '37c7850d-f1c7-40a5-970c-68de60688ebf',
  status: 201,
  duration: 4,
  unitId: 'anon',
  userId: 2
}
[INFO] [REQ] POST /admin/users {
  requestId: '00fb6b81-5449-4661-bc16-67f51630f351',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Success: User 2 (admin@propulse.com)
[INFO] [RES] POST /admin/users {
  requestId: '00fb6b81-5449-4661-bc16-67f51630f351',
  status: 200,
  duration: 86,
  unitId: 'anon',
  userId: 2
}
[INFO] [REQ] POST /admin/login {
  requestId: '130a20f3-5a68-45e3-a2be-9e098dd14f77',
  ip: '::ffff:127.0.0.1'
}
[Auth] Login attempt: {
  email: 'user_a_sec_1769127200235@test.com',
  hasPassword: true,
  contentType: 'application/json'
}
[INFO] [RES] POST /admin/login {
  requestId: '130a20f3-5a68-45e3-a2be-9e098dd14f77',
  status: 200,
  duration: 77,
  unitId: 'anon',
  userId: 'anon'
}
[INFO] [REQ] POST /leads {
  requestId: 'f2b1d9cd-c314-4c17-bc96-f6e6f9c85fa7',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Success: User 2 (admin@propulse.com)
[INFO] [RES] POST /leads {
  requestId: 'f2b1d9cd-c314-4c17-bc96-f6e6f9c85fa7',
  status: 201,
  duration: 4,
  unitId: 3,
  userId: 2
}
[INFO] [REQ] GET /leads/2 {
  requestId: 'ec5f886d-445d-4984-9f63-75d3fca3a4e2',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Success: User 4 (user_a_sec_1769127200235@test.com)
[INFO] [RES] GET /leads/2 {
  requestId: 'ec5f886d-445d-4984-9f63-75d3fca3a4e2',
  status: 200,
  duration: 17,
  unitId: 2,
  userId: 4
}
ÔûÂ ­ƒøí´©Å Security: Multi-Tenant Isolation
  ÔûÂ ÔØî Cross-Tenant Access Attempt
    [31mÔ£û should block user from accessing leads of another unit [90m(32.9537ms)[39m[39m
[INFO] [REQ] GET /conversations?unitId=3 {
  requestId: 'd2b3e0ff-f123-4609-be29-72675265f50d',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Success: User 4 (user_a_sec_1769127200235@test.com)
[SECURITY] Auth Failed: user_a_sec_1769127200235@test.com - Cross-tenant access attempt: requested 3 but belongs to 2
[INFO] [RES] GET /conversations?unitId=3 {
  requestId: 'd2b3e0ff-f123-4609-be29-72675265f50d',
  status: 403,
  duration: 3,
  unitId: 2,
  userId: 4
}
    [32mÔ£ö should block user from listing conversations of another unit [90m(15.1967ms)[39m[39m
  [31mÔ£û ÔØî Cross-Tenant Access Attempt [90m(49.8475ms)[39m[39m
[INFO] [REQ] GET /leads?unit_id=3 {
  requestId: '1e73a50a-c599-4031-aed6-815bb516224b',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Success: User 2 (admin@propulse.com)
[INFO] [RES] GET /leads?unit_id=3 {
  requestId: '1e73a50a-c599-4031-aed6-815bb516224b',
  status: 200,
  duration: 5,
  unitId: '3',
  userId: 2
}
  ÔûÂ Ô£à Super Admin Access
    [32mÔ£ö should allow super admin to access any unit [90m(16.1617ms)[39m[39m
  [32mÔ£ö Ô£à Super Admin Access [90m(16.4961ms)[39m[39m
[INFO] [REQ] GET /leads {
  requestId: '944b4b35-dadc-403e-8b30-d225d30038fe',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Failed: unknown - Missing authorization header
[INFO] [RES] GET /leads {
  requestId: '944b4b35-dadc-403e-8b30-d225d30038fe',
  status: 401,
  duration: 2,
  unitId: 'anon',
  userId: 'anon'
}
  ÔûÂ ­ƒöÆ Authentication Required
    [32mÔ£ö should reject requests without token [90m(12.406ms)[39m[39m
[INFO] [REQ] GET /leads {
  requestId: '2d899a02-f364-4ac4-bad7-91225f502db2',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Failed: unknown - Invalid or expired token
[INFO] [RES] GET /leads {
  requestId: '2d899a02-f364-4ac4-bad7-91225f502db2',
  status: 401,
  duration: 2,
  unitId: 'anon',
  userId: 'anon'
}
    [32mÔ£ö should reject requests with invalid token [90m(11.5596ms)[39m[39m
  [32mÔ£ö ­ƒöÆ Authentication Required [90m(24.5514ms)[39m[39m
[INFO] [REQ] POST /admin/login {
  requestId: '2d88910a-9513-4dec-b945-cd040ac8ba2f',
  ip: '::ffff:127.0.0.1'
}
[Auth] Login attempt: {
  email: 'fake@test.com',
  hasPassword: true,
  contentType: 'application/json'
}
[INFO] [RES] POST /admin/login {
  requestId: '2d88910a-9513-4dec-b945-cd040ac8ba2f',
  status: 401,
  duration: 2,
  unitId: 'anon',
  userId: 'anon'
}
[INFO] [REQ] POST /admin/login {
  requestId: '64683023-a104-41ef-b162-ff08f5e25bc1',
  ip: '::ffff:127.0.0.1'
}
[Auth] Login attempt: {
  email: 'fake@test.com',
  hasPassword: true,
  contentType: 'application/json'
}
[INFO] [RES] POST /admin/login {
  requestId: '64683023-a104-41ef-b162-ff08f5e25bc1',
  status: 401,
  duration: 1,
  unitId: 'anon',
  userId: 'anon'
}
[INFO] [REQ] POST /admin/login {
  requestId: 'a8637472-b3f5-48fc-ab20-b7a3baa4565b',
  ip: '::ffff:127.0.0.1'
}
[Auth] Login attempt: {
  email: 'fake@test.com',
  hasPassword: true,
  contentType: 'application/json'
}
[INFO] [RES] POST /admin/login {
  requestId: 'a8637472-b3f5-48fc-ab20-b7a3baa4565b',
  status: 401,
  duration: 2,
  unitId: 'anon',
  userId: 'anon'
}
[INFO] [REQ] POST /admin/login {
  requestId: '5904b3fc-b491-4b60-917e-ed776c5c2f07',
  ip: '::ffff:127.0.0.1'
}
[Auth] Login attempt: {
  email: 'fake@test.com',
  hasPassword: true,
  contentType: 'application/json'
}
[INFO] [RES] POST /admin/login {
  requestId: '5904b3fc-b491-4b60-917e-ed776c5c2f07',
  status: 401,
  duration: 2,
  unitId: 'anon',
  userId: 'anon'
}
[INFO] [REQ] POST /admin/login {
  requestId: '23e510b4-e886-42e7-8097-76ba744388ac',
  ip: '::ffff:127.0.0.1'
}
[Auth] Login attempt: {
  email: 'fake@test.com',
  hasPassword: true,
  contentType: 'application/json'
}
[INFO] [RES] POST /admin/login {
  requestId: '23e510b4-e886-42e7-8097-76ba744388ac',
  status: 401,
  duration: 1,
  unitId: 'anon',
  userId: 'anon'
}
[INFO] [REQ] POST /admin/login {
  requestId: 'a220ef5e-fd89-42cc-be99-f58d2eab0915',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Failed: fake@test.com - Rate limit exceeded
[INFO] [RES] POST /admin/login {
  requestId: 'a220ef5e-fd89-42cc-be99-f58d2eab0915',
  status: 429,
  duration: 1,
  unitId: 'anon',
  userId: 'anon'
}
[INFO] [REQ] POST /admin/login {
  requestId: '3efd1266-d37e-47d0-aab2-b41f1b9370c3',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Failed: fake@test.com - Rate limit exceeded
[INFO] [RES] POST /admin/login {
  requestId: '3efd1266-d37e-47d0-aab2-b41f1b9370c3',
  status: 429,
  duration: 1,
  unitId: 'anon',
  userId: 'anon'
}
[INFO] [REQ] POST /admin/login {
  requestId: '8271b25b-da6a-41a2-8cf3-5c06400e3204',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Failed: fake@test.com - Rate limit exceeded
[INFO] [RES] POST /admin/login {
  requestId: '8271b25b-da6a-41a2-8cf3-5c06400e3204',
  status: 429,
  duration: 1,
  unitId: 'anon',
  userId: 'anon'
}
[INFO] [REQ] POST /admin/login {
  requestId: 'f07363d9-d76c-4c2a-9896-c69cb87022e3',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Failed: fake@test.com - Rate limit exceeded
[INFO] [RES] POST /admin/login {
  requestId: 'f07363d9-d76c-4c2a-9896-c69cb87022e3',
  status: 429,
  duration: 1,
  unitId: 'anon',
  userId: 'anon'
}
[INFO] [REQ] POST /admin/login {
  requestId: 'aa2b1507-08e7-4c9e-9c01-b53ef4d5f372',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Failed: fake@test.com - Rate limit exceeded
[INFO] [RES] POST /admin/login {
  requestId: 'aa2b1507-08e7-4c9e-9c01-b53ef4d5f372',
  status: 429,
  duration: 2,
  unitId: 'anon',
  userId: 'anon'
}
[INFO] [REQ] POST /admin/login {
  requestId: 'aabd1153-d1c8-4536-ad85-c99cdb9cb801',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Failed: fake@test.com - Rate limit exceeded
[INFO] [RES] POST /admin/login {
  requestId: 'aabd1153-d1c8-4536-ad85-c99cdb9cb801',
  status: 429,
  duration: 1,
  unitId: 'anon',
  userId: 'anon'
}
[INFO] [REQ] POST /admin/login {
  requestId: 'c73e1838-3073-4a33-bcba-498719cabe17',
  ip: '::ffff:127.0.0.1'
}
[SECURITY] Auth Failed: fake@test.com - Rate limit exceeded
[INFO] [RES] POST /admin/login {
  requestId: 'c73e1838-3073-4a33-bcba-498719cabe17',
  status: 429,
  duration: 2,
  unitId: 'anon',
  userId: 'anon'
}
  ÔûÂ ­ƒÜ¿ Rate Limiting
    [32mÔ£ö should block excessive login attempts [90m(96.0893ms)[39m[39m
  [32mÔ£ö ­ƒÜ¿ Rate Limiting [90m(96.4827ms)[39m[39m
[31mÔ£û ­ƒøí´©Å Security: Multi-Tenant Isolation [90m(822.2662ms)[39m[39m
[INFO] Flushing metrics to DB...
[ERROR] [requeueWorker] unexpected error supabase.from(...).select(...).in is not a function
[ERROR] [requeueWorker] unexpected error supabase.from(...).select(...).in is not a function
