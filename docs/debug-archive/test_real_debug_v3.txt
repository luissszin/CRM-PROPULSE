Supabase environment variables missing; using in-memory DB for development.
ÔûÂ ­ƒÜÇ Real Integration Flow Tests
  ÔûÂ ­ƒöæ Auth & Access Control (Leads)
    [32mÔ£ö GET /leads requires auth [90m(33.8574ms)[39m[39m
    [32mÔ£ö GET /leads accepts valid token [90m(6.034ms)[39m[39m
    [31mÔ£û GET /leads with invalid role/permission (cross-tenant check) [90m(8.8684ms)[39m[39m
  [31mÔ£û ­ƒöæ Auth & Access Control (Leads) [90m(50.0683ms)[39m[39m
  ÔûÂ ­ƒôí WhatsApp Webhooks
    [32mÔ£ö POST /webhooks/whatsapp/evolution/:secret with INVALID secret returns 401 [90m(7.7869ms)[39m[39m
    [32mÔ£ö POST /webhooks/whatsapp/invalid_provider/:secret returns 400 [90m(5.7364ms)[39m[39m
Test Failed 500 Body: {
  "error": "Connection not found or invalid secret"
}
    [31mÔ£û POST /webhooks/whatsapp/evolution/:secret with VALID payload returns 200 [90m(8.109ms)[39m[39m
  [31mÔ£û ­ƒôí WhatsApp Webhooks [90m(22.3647ms)[39m[39m
  ÔûÂ ­ƒøí´©Å Rate Limits
    [32mÔ£ö Should BLOCK requests without bypass header when flooded [90m(29.6352ms)[39m[39m
    [32mÔ£ö Should ALLOW requests WITH bypass header even if flooded [90m(28.2668ms)[39m[39m
  [32mÔ£ö ­ƒøí´©Å Rate Limits [90m(58.3489ms)[39m[39m
[31mÔ£û ­ƒÜÇ Real Integration Flow Tests [90m(136.8692ms)[39m[39m
[34mÔä╣ tests 8[39m
[34mÔä╣ suites 4[39m
[34mÔä╣ pass 6[39m
[34mÔä╣ fail 2[39m
[34mÔä╣ cancelled 0[39m
[34mÔä╣ skipped 0[39m
[34mÔä╣ todo 0[39m
[34mÔä╣ duration_ms 653.4752[39m

[31mÔ£û failing tests:[39m

test at backend\tests\integration_real.test.js:76:9
[31mÔ£û GET /leads with invalid role/permission (cross-tenant check) [90m(8.8684ms)[39m[39m
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  201 !== 403
  
      at TestContext.<anonymous> (file:///C:/Users/jogod/crm-backend/backend/tests/integration_real.test.js:83:21)
      at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
      at async Test.run (node:internal/test_runner/test:1113:7)
      at async Suite.processPendingSubtests (node:internal/test_runner/test:788:7) {
    generatedMessage: true,
    code: 'ERR_ASSERTION',
    actual: 201,
    expected: 403,
    operator: 'strictEqual',
    diff: 'simple'
  }

test at backend\tests\integration_real.test.js:106:9
[31mÔ£û POST /webhooks/whatsapp/evolution/:secret with VALID payload returns 200 [90m(8.109ms)[39m[39m
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  401 !== 200
  
      at TestContext.<anonymous> (file:///C:/Users/jogod/crm-backend/backend/tests/integration_real.test.js:127:20)
      at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
      at async Test.run (node:internal/test_runner/test:1113:7)
      at async Suite.processPendingSubtests (node:internal/test_runner/test:788:7) {
    generatedMessage: true,
    code: 'ERR_ASSERTION',
    actual: 401,
    expected: 200,
    operator: 'strictEqual',
    diff: 'simple'
  }
