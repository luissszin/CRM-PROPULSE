Supabase client initialized
ÔûÂ ­ƒÜÇ Real Integration Flow Tests
  ÔûÂ ­ƒöæ Auth & Access Control (Leads)
    [32mÔ£ö GET /leads requires auth [90m(14.0297ms)[39m[39m
    [32mÔ£ö GET /leads accepts valid token [90m(685.2461ms)[39m[39m
    [32mÔ£ö GET /leads with invalid role/permission (cross-tenant check) [90m(307.2269ms)[39m[39m
  [32mÔ£ö ­ƒöæ Auth & Access Control (Leads) [90m(1007.4717ms)[39m[39m
  ÔûÂ ­ƒôí WhatsApp Webhooks
    [32mÔ£ö POST /webhooks/whatsapp/evolution/:secret with INVALID secret returns 401 [90m(316.9048ms)[39m[39m
    [31mÔ£û POST /webhooks/whatsapp/invalid_provider/:secret returns 400 [90m(339.7607ms)[39m[39m
    [31mÔ£û POST /webhooks/whatsapp/evolution/:secret with VALID payload returns 200 [90m(1495.2336ms)[39m[39m
  [31mÔ£û ­ƒôí WhatsApp Webhooks [90m(2152.5283ms)[39m[39m
  ÔûÂ ­ƒøí´©Å Rate Limits
    [32mÔ£ö Should BLOCK requests without bypass header when flooded [90m(30.9451ms)[39m[39m
    [32mÔ£ö Should ALLOW requests WITH bypass header even if flooded [90m(1830.5725ms)[39m[39m
  [32mÔ£ö ­ƒøí´©Å Rate Limits [90m(1861.8616ms)[39m[39m
[31mÔ£û ­ƒÜÇ Real Integration Flow Tests [90m(7164.7905ms)[39m[39m
[34mÔä╣ tests 8[39m
[34mÔä╣ suites 4[39m
[34mÔä╣ pass 6[39m
[34mÔä╣ fail 2[39m
[34mÔä╣ cancelled 0[39m
[34mÔä╣ skipped 0[39m
[34mÔä╣ todo 0[39m
[34mÔä╣ duration_ms 7967.395[39m

[31mÔ£û failing tests:[39m

test at backend\tests\integration_real.test.js:107:9
[31mÔ£û POST /webhooks/whatsapp/invalid_provider/:secret returns 400 [90m(339.7607ms)[39m[39m
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  401 !== 400
  
      at TestContext.<anonymous> (file:///C:/Users/jogod/crm-backend/backend/tests/integration_real.test.js:113:20)
      at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
      at async Test.run (node:internal/test_runner/test:1113:7)
      at async Suite.processPendingSubtests (node:internal/test_runner/test:788:7) {
    generatedMessage: true,
    code: 'ERR_ASSERTION',
    actual: 401,
    expected: 400,
    operator: 'strictEqual',
    diff: 'simple'
  }

test at backend\tests\integration_real.test.js:116:9
[31mÔ£û POST /webhooks/whatsapp/evolution/:secret with VALID payload returns 200 [90m(1495.2336ms)[39m[39m
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  500 !== 200
  
      at TestContext.<anonymous> (file:///C:/Users/jogod/crm-backend/backend/tests/integration_real.test.js:134:20)
      at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
      at async Test.run (node:internal/test_runner/test:1113:7)
      at async Suite.processPendingSubtests (node:internal/test_runner/test:788:7) {
    generatedMessage: true,
    code: 'ERR_ASSERTION',
    actual: 500,
    expected: 200,
    operator: 'strictEqual',
    diff: 'simple'
  }
